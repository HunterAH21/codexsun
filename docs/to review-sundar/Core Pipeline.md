perfect üëç ‚Äî here‚Äôs the **expanded route-to-file table** with the legend **inlined per route group**, so every route shows not only its controller/action/service but also which middleware, guards, interceptors, pipes, and policies apply.

---

# üìë Route-to-File Map (with Full Pipeline)

| **HTTP Route**                               | **Controller**          | **Action File**                     | **Service / Repo**                           | **Middleware**                                                  | **Guards / Policies**                                                 | **Interceptors / Pipes / Decorators**                                                    |
| -------------------------------------------- | ----------------------- | ----------------------------------- | -------------------------------------------- | --------------------------------------------------------------- | --------------------------------------------------------------------- | ---------------------------------------------------------------------------------------- |
| **TENANT**                                   |                         |                                     |                                              |                                                                 |                                                                       |                                                                                          |
| `POST /tenants`                              | `Tenants.controller.ts` | `CreateTenant.action.ts`            | `Tenant.service.ts` ‚Üí `Tenant.repository.ts` | `RequestLogger`, `AuthContext`, `TenantHeader`, `TenantContext` | `JwtAuth.guard`                                                       | Pipes: `Validation.pipe` ¬∑ Decorators: `CurrentTenant`                                   |
| `GET /tenants`                               | `Tenants.controller.ts` | `ListTenants.action.ts`             | `Tenant.service.ts` ‚Üí `Tenant.repository.ts` | same as above                                                   | `JwtAuth.guard`                                                       | Query DTO: `ListTenants.query.ts` ¬∑ Interceptors: `TenantSerialization`, `Serialization` |
| `GET /tenants/:tenantId`                     | `Tenants.controller.ts` | `GetTenant.action.ts`               | `Tenant.service.ts`                          | same as above                                                   | `JwtAuth.guard`                                                       | Pipes: `ParseObjectId.pipe`                                                              |
| `PATCH /tenants/:tenantId`                   | `Tenants.controller.ts` | `UpdateTenant.action.ts`            | `Tenant.service.ts`                          | same as above                                                   | `JwtAuth.guard`, `TenantOwner.policy`                                 | Pipes: `Validation.pipe`, `ParseObjectId.pipe`                                           |
| `DELETE /tenants/:tenantId`                  | `Tenants.controller.ts` | `DeleteTenant.action.ts`            | `Tenant.service.ts`                          | same as above                                                   | `JwtAuth.guard`, `TenantOwner.policy`                                 | Pipes: `ParseObjectId.pipe`                                                              |
| `POST /tenants/:tenantId/deactivate`         | `Tenants.controller.ts` | `DeactivateTenant.action.ts`        | `Tenant.service.ts`                          | same as above                                                   | `JwtAuth.guard`, `TenantOwner.policy`                                 | ‚Äî                                                                                        |
| `POST /tenants/:tenantId/reactivate`         | `Tenants.controller.ts` | `ReactivateTenant.action.ts`        | `Tenant.service.ts`                          | same as above                                                   | `JwtAuth.guard`, `TenantOwner.policy`                                 | ‚Äî                                                                                        |
| `POST /tenants/:tenantId/transfer-ownership` | `Tenants.controller.ts` | `TransferTenantOwnership.action.ts` | `Tenant.service.ts`                          | same as above                                                   | `JwtAuth.guard`, `TenantOwner.policy`                                 | ‚Äî                                                                                        |
| **USER**                                     |                         |                                     |                                              |                                                                 |                                                                       |                                                                                          |
| `POST /users`                                | `Users.controller.ts`   | `RegisterUser.action.ts`            | `User.service.ts` ‚Üí `User.repository.ts`     | `RequestLogger`, `AuthContext`, `CurrentUser`, `TenantContext`  | `OptionalJwt.guard` (public signup) or `JwtAuth.guard` (admin create) | Pipes: `Validation.pipe` ¬∑ Decorators: `CurrentTenant`                                   |
| `POST /users/invitations`                    | `Users.controller.ts`   | `InviteUser.action.ts`              | `User.service.ts`                            | same as above                                                   | `JwtAuth.guard`, `CanManageUsers.policy`                              | Pipes: `Validation.pipe`                                                                 |
| `POST /users/invitations/accept`             | `Users.controller.ts`   | `AcceptInvitation.action.ts`        | `User.service.ts`                            | `RequestLogger`, `AuthContext`, `TenantContext`                 | `OptionalJwt.guard`                                                   | Pipes: `Validation.pipe`                                                                 |
| `GET /users`                                 | `Users.controller.ts`   | `ListUsers.action.ts`               | `User.service.ts`                            | same as above                                                   | `JwtAuth.guard`                                                       | Query: `ListUsers.query.ts` ¬∑ Interceptors: `UserSerialization`, `Serialization`         |
| `GET /users/search`                          | `Users.controller.ts`   | `SearchUsers.action.ts`             | `User.service.ts`                            | same as above                                                   | `JwtAuth.guard`                                                       | Query: `SearchUsers.query.ts`                                                            |
| `GET /users/:userId`                         | `Users.controller.ts`   | `GetUser.action.ts`                 | `User.service.ts`                            | same as above                                                   | `JwtAuth.guard`, `UserSelfOrAdmin.policy`                             | Pipes: `ParseObjectId.pipe`                                                              |
| `PATCH /users/:userId`                       | `Users.controller.ts`   | `UpdateUser.action.ts`              | `User.service.ts`                            | same as above                                                   | `JwtAuth.guard`, `UserSelfOrAdmin.policy`                             | Pipes: `Validation.pipe`, `ParseObjectId.pipe`                                           |
| `POST /users/:userId/deactivate`             | `Users.controller.ts`   | `DeactivateUser.action.ts`          | `User.service.ts`                            | same as above                                                   | `JwtAuth.guard`, `ManageRoles.policy`                                 | ‚Äî                                                                                        |
| `POST /users/:userId/reactivate`             | `Users.controller.ts`   | `ReactivateUser.action.ts`          | `User.service.ts`                            | same as above                                                   | `JwtAuth.guard`, `ManageRoles.policy`                                 | ‚Äî                                                                                        |
| `POST /users/:userId/roles`                  | `Users.controller.ts`   | `AssignRole.action.ts`              | `User.service.ts`                            | same as above                                                   | `JwtAuth.guard`, `ManageRoles.policy`                                 | ‚Äî                                                                                        |
| `DELETE /users/:userId/roles/:role`          | `Users.controller.ts`   | `RevokeRole.action.ts`              | `User.service.ts`                            | same as above                                                   | `JwtAuth.guard`, `ManageRoles.policy`                                 | ‚Äî                                                                                        |
| `POST /users/:userId/permissions`            | `Users.controller.ts`   | `GrantPermission.action.ts`         | `User.service.ts`                            | same as above                                                   | `JwtAuth.guard`, `ManageRoles.policy`                                 | ‚Äî                                                                                        |
| `DELETE /users/:userId/permissions/:perm`    | `Users.controller.ts`   | `RevokePermission.action.ts`        | `User.service.ts`                            | same as above                                                   | `JwtAuth.guard`, `ManageRoles.policy`                                 | ‚Äî                                                                                        |
| **AUTH**                                     |                         |                                     |                                              |                                                                 |                                                                       |                                                                                          |
| `POST /auth/login`                           | `Auth.controller.ts`    | `AuthenticateUser.action.ts`        | `Auth.service.ts` + `Tokens.service.ts`      | `RequestLogger`, `AuthContext`                                  | `Public.decorator` ¬∑ `Local.strategy`                                 | Pipes: `Validation.pipe` ¬∑ Interceptors: `AuthSerialization`                             |
| `POST /auth/logout`                          | `Auth.controller.ts`    | `Logout.action.ts`                  | `Auth.service.ts` + `Session.repository.ts`  | `RequestLogger`, `AuthContext`                                  | `JwtAuth.guard`                                                       | ‚Äî                                                                                        |
| `POST /auth/refresh`                         | `Auth.controller.ts`    | `RefreshToken.action.ts`            | `Tokens.service.ts`                          | `RequestLogger`, `AuthContext`                                  | `OptionalJwt.guard` ¬∑ `RefreshJwt.strategy`                           | Pipes: `Validation.pipe`                                                                 |
| `POST /auth/password/request-reset`          | `Auth.controller.ts`    | `RequestPasswordReset.action.ts`    | `Passwords.service.ts`                       | `RequestLogger`, `AuthContext`                                  | `Public.decorator`                                                    | Pipes: `Validation.pipe`                                                                 |
| `POST /auth/password/reset`                  | `Auth.controller.ts`    | `ResetPassword.action.ts`           | `Passwords.service.ts`                       | same as above                                                   | `Public.decorator`                                                    | Pipes: `Validation.pipe`                                                                 |
| `POST /auth/mfa/enable`                      | `Auth.controller.ts`    | `EnableMfa.action.ts`               | `Mfa.service.ts`                             | `RequestLogger`, `AuthContext`                                  | `JwtAuth.guard`                                                       | Pipes: `Validation.pipe`                                                                 |
| `POST /auth/mfa/verify`                      | `Auth.controller.ts`    | `VerifyMfa.action.ts`               | `Mfa.service.ts`                             | same as above                                                   | `JwtAuth.guard`                                                       | Pipes: `Validation.pipe`                                                                 |
| `POST /auth/mfa/disable`                     | `Auth.controller.ts`    | `DisableMfa.action.ts`              | `Mfa.service.ts`                             | same as above                                                   | `JwtAuth.guard`                                                       | ‚Äî                                                                                        |

---

‚úÖ now every row shows the **exact pipeline** (middleware ‚Üí guards/policies ‚Üí interceptors/pipes ‚Üí decorators).
this can double as both **dev reference** and **docs**.

do you want me to also collapse this into a **visual sequence diagram** (middleware ‚Üí guards ‚Üí controller ‚Üí action ‚Üí service) for one example route (say `PATCH /users/:userId`) to make the flow crystal-clear?
